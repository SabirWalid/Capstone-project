<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Refugee Techpreneurs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --primary-bg: #f8fffe;
      --secondary-bg: #2c5f5d;
      --tertiary-accent: #00b894;
      --text-color: #2d3436;
      --card-bg: #ffffff;
      --border-color: #ddd;
      --text-secondary: #636e72;
      --shadow: 0 10px 30px rgba(44, 95, 93, 0.08);
    }
    
    body {
      background: linear-gradient(135deg, var(--primary-bg) 0%, #e8f5f5 100%);
      color: var(--text-color);
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
    }
    
    .landing-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    .landing-header {
      background: var(--secondary-bg);
      color: white;
      padding: 2rem 0;
      text-align: center;
      position: relative;
    }
    
    .landing-header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
      color: white;
    }
    
    .landing-header p {
      font-size: 1.2rem;
      margin: 0.5rem 0 0 0;
      opacity: 0.9;
    }
    
    .landing-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
    }
    
    .landing-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 4rem 3rem;
      box-shadow: var(--shadow);
      border: 1px solid rgba(44, 95, 93, 0.1);
      text-align: center;
      max-width: 500px;
      width: 100%;
    }
    
    .landing-card h2 {
      color: var(--secondary-bg);
      font-size: 2rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    
    .landing-card p {
      color: var(--text-secondary);
      font-size: 1.1rem;
      margin-bottom: 3rem;
      line-height: 1.6;
    }
    
    .auth-buttons {
      display: flex;
      gap: 1rem;
      flex-direction: column;
    }
    
    @media (min-width: 576px) {
      .auth-buttons {
        flex-direction: row;
        justify-content: center;
      }
    }
    
    .auth-btn {
      padding: 1rem 2rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.1rem;
      text-decoration: none;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      min-width: 160px;
    }
    
    .auth-btn-primary {
      background: var(--tertiary-accent);
      color: white;
      border: none;
    }
    
    .auth-btn-primary:hover {
      background: #00a085;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
    }
    
    .auth-btn-secondary {
      background: transparent;
      color: var(--secondary-bg);
      border: 2px solid var(--secondary-bg);
    }
    
    .auth-btn-secondary:hover {
      background: var(--secondary-bg);
      color: white;
      transform: translateY(-2px);
    }
    
    .features {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid #e8f5f5;
    }
    
    .features h3 {
      color: var(--secondary-bg);
      font-size: 1.3rem;
      margin-bottom: 1rem;
    }
    
    .features-list {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: left;
    }
    
    .features-list li {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      color: var(--text-color);
    }
    
    .features-list .material-icons {
      color: var(--tertiary-accent);
      font-size: 1.2rem;
    }
    
    .auth-container {
      max-width: 450px;
      width: 100%;
      margin: 2rem auto;
      padding: 0 2rem;
    }
    
    .auth-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 3rem 2.5rem;
      box-shadow: var(--shadow);
      border: 1px solid rgba(44, 95, 93, 0.1);
    }
    
    .auth-header {
      text-align: center;
      margin-bottom: 2.5rem;
    }
    
    .auth-header h2 {
      color: var(--secondary-bg);
      font-weight: 700;
      margin-bottom: 0.5rem;
      font-size: 2rem;
    }
    
    .auth-header p {
      color: var(--text-secondary);
      margin: 0;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 0.5rem;
      display: block;
    }
    
    .form-control {
      border: 2px solid #e8f5f5;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #fafafa;
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--tertiary-accent);
      box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
      background: white;
    }
    
    .btn-primary {
      background: var(--tertiary-accent);
      border: none;
      border-radius: 12px;
      padding: 0.875rem 2rem;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 1rem;
    }
    
    .btn-primary:hover {
      background: #00a085;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
    }
    
    .btn-secondary {
      background: transparent;
      border: 2px solid var(--secondary-bg);
      color: var(--secondary-bg);
      border-radius: 12px;
      padding: 0.875rem 2rem;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 0.5rem;
    }
    
    .btn-secondary:hover {
      background: var(--secondary-bg);
      color: white;
      transform: translateY(-2px);
    }
    
    .auth-switch {
      text-align: center;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e8f5f5;
    }
    
    .auth-switch a {
      color: var(--tertiary-accent);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    
    .auth-switch a:hover {
      color: var(--secondary-bg);
    }
    
    .alert {
      border: none;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .alert-danger {
      background: #ffe6e6;
      color: #c62828;
    }
    
    .alert-success {
      background: #e8f5e8;
      color: #2e7d32;
    }
    
    .password-field {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0;
    }
    
    .loading {
      display: none;
      text-align: center;
      color: var(--text-secondary);
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--tertiary-accent);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 0.5rem;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .admin-header {
      background: var(--secondary-bg);
      color: white;
      padding: 2rem 0;
      margin-bottom: 2rem;
      border-radius: 0 0 15px 15px;
    }
    
    .admin-header h2 {
      color: white;
      font-weight: 700;
      margin: 0;
      text-align: center;
    }
    
    .admin-nav {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 4px 15px rgba(44, 95, 93, 0.1);
      margin-bottom: 2rem;
    }
    
    .admin-nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }
    
    .admin-nav li {
      background: var(--primary-bg);
      border-radius: 10px;
      transition: all 0.3s ease;
    }
    
    .admin-nav li:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 184, 148, 0.15);
    }
    
    .admin-nav a {
      display: block;
      padding: 1.5rem;
      color: var(--text-color);
      text-decoration: none;
      font-weight: 600;
      border-radius: 10px;
      border-left: 4px solid var(--tertiary-accent);
      transition: all 0.3s ease;
    }
    
    .admin-nav a:hover {
      color: var(--tertiary-accent);
      background: white;
    }
    
    #admin-content {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 4px 15px rgba(44, 95, 93, 0.1);
      min-height: 400px;
    }
    
    .admin-panel {
      display: none;
    }
    
    .admin-panel.active {
      display: block;
    }
    
    .auth-section {
      display: none;
    }
    
    .auth-section.active {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem 0;
    }
    
    .landing-section {
      display: block;
    }
    
    .landing-section.hidden {
      display: none;
    }
    
    .container {
      max-width: 1200px;
    }
    
    .logout-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      color: white;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <!-- Landing Page Section -->
  <div id="landing-section" class="landing-section">
    <div class="landing-container">
      <div class="landing-header">
        <div class="container">
          <h1>🛡️ Admin Panel</h1>
          <p>Refugee Techpreneurs Platform Management</p>
        </div>
      </div>
      
      <div class="landing-content">
        <div class="landing-card">
          <h2>Welcome, Administrator</h2>
          <p>Manage and oversee the Refugee Techpreneurs platform. Access powerful tools to manage users, content, opportunities, and analytics.</p>
          
          <div class="auth-buttons">
            <button class="auth-btn auth-btn-primary" onclick="showLoginForm()">
              <span class="material-icons">login</span>
              Sign In
            </button>
            <button class="auth-btn auth-btn-secondary" onclick="showRegisterForm()">
              <span class="material-icons">person_add</span>
              Register
            </button>
          </div>
          
          <div class="features">
            <h3>Admin Features</h3>
            <ul class="features-list">
              <li>
                <span class="material-icons">people</span>
                User Management & Analytics
              </li>
              <li>
                <span class="material-icons">school</span>
                Course & Content Management
              </li>
              <li>
                <span class="material-icons">work</span>
                Opportunity Posting & Tracking
              </li>
              <li>
                <span class="material-icons">forum</span>
                Forum & Communication Tools
              </li>
              <li>
                <span class="material-icons">analytics</span>
                Advanced Analytics & Reporting
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Authentication Section -->
  <div id="auth-section" class="auth-section">
    <div class="auth-container">
    <!-- Login Form -->
    <div id="login-form" class="auth-card">
      <div class="auth-header">
        <h2>🔐 Admin Login</h2>
        <p>Access the admin control panel</p>
      </div>
      
      <div id="login-alert" class="alert alert-danger" style="display: none;"></div>
      
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="loginEmail" placeholder="admin@example.com" required>
        </div>
        
        <div class="form-group">
          <label for="loginPassword" class="form-label">Password</label>
          <div class="password-field">
            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
            <button type="button" class="password-toggle" onclick="togglePassword('loginPassword')">
              <span class="material-icons">visibility</span>
            </button>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <div id="login-loading" class="loading">
            <div class="spinner"></div>
            Signing in...
          </div>
          <span id="login-text">Sign In</span>
        </button>
      </form>
      
      <div class="auth-switch">
        <p>Don't have an admin account? <a href="#" onclick="showRegister()">Register here</a></p>
      </div>
    </div>
    
    <!-- Registration Form -->
    <div id="register-form" class="auth-card" style="display: none;">
      <div class="auth-header">
        <h2>👥 Admin Registration</h2>
        <p>Create a new admin account</p>
      </div>
      
      <div id="register-alert" class="alert alert-danger" style="display: none;"></div>
      
      <form id="registerForm">
        <div class="form-group">
          <label for="registerName" class="form-label">Full Name</label>
          <input type="text" class="form-control" id="registerName" placeholder="John Doe" required>
        </div>
        
        <div class="form-group">
          <label for="registerEmail" class="form-label">Email Address</label>
          <input type="email" class="form-control" id="registerEmail" placeholder="admin@example.com" required>
        </div>
        
        <div class="form-group">
          <label for="registerPassword" class="form-label">Password</label>
          <div class="password-field">
            <input type="password" class="form-control" id="registerPassword" placeholder="Enter a strong password" required>
            <button type="button" class="password-toggle" onclick="togglePassword('registerPassword')">
              <span class="material-icons">visibility</span>
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword" class="form-label">Confirm Password</label>
          <div class="password-field">
            <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm your password" required>
            <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
              <span class="material-icons">visibility</span>
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="adminCode" class="form-label">Admin Code</label>
          <input type="text" class="form-control" id="adminCode" placeholder="Enter admin authorization code" required>
          <small class="text-muted">Contact system administrator for the admin code</small>
        </div>
        
        <button type="submit" class="btn btn-primary">
          <div id="register-loading" class="loading">
            <div class="spinner"></div>
            Creating account...
          </div>
          <span id="register-text">Create Account</span>
        </button>
      </form>
      
      <div class="auth-switch">
        <p>Already have an account? <a href="#" onclick="showLogin()">Sign in here</a></p>
      </div>
    </div>
    
    <div class="text-center mt-3">
      <button class="btn btn-link" onclick="showLanding()">
        <span class="material-icons">arrow_back</span>
        Back to Welcome
      </button>
    </div>
  </div>
  
  <!-- Admin Panel Section -->
  <div id="admin-panel" class="admin-panel">
    <div class="admin-header">
      <div class="container">
        <h2>Admin Control Panel</h2>
        <a href="#" class="logout-btn" onclick="logout()">
          <span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">logout</span>
          Logout
        </a>
      </div>
    </div>
    
    <div class="container">
      <div class="admin-nav">
        <ul>
          <li><a href="#" onclick="redirectToSection('users')">👥 Manage Users</a></li>
          <li><a href="#" onclick="redirectToSection('courses')">📚 Manage Courses</a></li>
          <li><a href="#" onclick="redirectToSection('opportunities')">🚀 Post Opportunities</a></li>
          <li><a href="#" onclick="redirectToSection('mentors')">👨‍🏫 Manage Mentors</a></li>
          <li><a href="#" onclick="redirectToSection('resources')">📁 Manage Resources</a></li>
          <li><a href="#" onclick="redirectToSection('forum')">💬 Forum Management</a></li>
          <li><a href="#" onclick="redirectToSection('analytics')">📊 View Analytics</a></li>
          <li><a href="admin-dashboard.html">🎛️ Full Dashboard</a></li>
        </ul>
      </div>
      
      <div id="admin-content">
        <div class="text-center text-muted">
          <h4>Welcome to Admin Panel</h4>
          <p>Select an option from the menu above to manage the platform, or use the Full Dashboard for complete functionality.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentAdmin = null;
    
    // Check if admin is already logged in on page load
    document.addEventListener('DOMContentLoaded', function() {
      const token = localStorage.getItem('adminToken');
      if (token) {
        // Verify token with server
        verifyAdminToken(token);
      } else {
        // Show landing page
        showLanding();
      }
    });
    
    // Landing page navigation
    function showLanding() {
      document.getElementById('landing-section').style.display = 'block';
      document.getElementById('auth-section').classList.remove('active');
      document.getElementById('admin-panel').style.display = 'none';
      clearAlerts();
    }
    
    function showLoginForm() {
      document.getElementById('landing-section').style.display = 'none';
      document.getElementById('auth-section').classList.add('active');
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
      clearAlerts();
    }
    
    function showRegisterForm() {
      document.getElementById('landing-section').style.display = 'none';
      document.getElementById('auth-section').classList.add('active');
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
      clearAlerts();
    }
    
    // Toggle password visibility
    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId);
      const icon = field.nextElementSibling.querySelector('.material-icons');
      
      if (field.type === 'password') {
        field.type = 'text';
        icon.textContent = 'visibility_off';
      } else {
        field.type = 'password';
        icon.textContent = 'visibility';
      }
    }
    
    // Show/hide forms
    function showLogin() {
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('register-form').style.display = 'none';
      clearAlerts();
    }
    
    function showRegister() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('register-form').style.display = 'block';
      clearAlerts();
    }
    
    function clearAlerts() {
      document.getElementById('login-alert').style.display = 'none';
      document.getElementById('register-alert').style.display = 'none';
    }
    
    // Show loading state
    function showLoading(type) {
      const loadingEl = document.getElementById(`${type}-loading`);
      const textEl = document.getElementById(`${type}-text`);
      const submitBtn = document.querySelector(`#${type}Form button[type="submit"]`);
      
      loadingEl.style.display = 'block';
      textEl.style.display = 'none';
      submitBtn.disabled = true;
    }
    
    // Hide loading state
    function hideLoading(type) {
      const loadingEl = document.getElementById(`${type}-loading`);
      const textEl = document.getElementById(`${type}-text`);
      const submitBtn = document.querySelector(`#${type}Form button[type="submit"]`);
      
      loadingEl.style.display = 'none';
      textEl.style.display = 'block';
      submitBtn.disabled = false;
    }
    
    // Show alert message
    function showAlert(type, message) {
      const alertEl = document.getElementById(`${type}-alert`);
      alertEl.textContent = message;
      alertEl.style.display = 'block';
    }
    
    // Verify admin token
    async function verifyAdminToken(token) {
      try {
        const response = await fetch('http://localhost:5000/api/admin/verify', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const admin = await response.json();
          currentAdmin = admin;
          // Redirect to admin dashboard if already logged in
          window.location.href = 'admin-dashboard.html';
        } else {
          localStorage.removeItem('adminToken');
          showLanding();
        }
      } catch (error) {
        console.error('Token verification error:', error);
        localStorage.removeItem('adminToken');
        showLanding();
      }
    }
    
    // Show admin panel
    function showAdminPanel() {
      document.getElementById('landing-section').style.display = 'none';
      document.getElementById('auth-section').classList.remove('active');
      document.getElementById('admin-panel').style.display = 'block';
    }
    
    // Show authentication section (not used directly anymore)
    function showAuthSection() {
      showLanding();
    }
    
    // Login form submission
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      if (!email || !password) {
        showAlert('login', 'Please fill in all fields');
        return;
      }
      
      showLoading('login');
      clearAlerts();
      
      try {
        const response = await fetch('http://localhost:5000/api/admin/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          localStorage.setItem('adminToken', data.token);
          currentAdmin = data.admin;
          // Redirect to admin dashboard instead of showing local admin panel
          window.location.href = 'admin-dashboard.html';
        } else {
          showAlert('login', data.error || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        showAlert('login', 'Connection error. Please try again.');
      } finally {
        hideLoading('login');
      }
    });
    
    // Registration form submission
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const name = document.getElementById('registerName').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const adminCode = document.getElementById('adminCode').value.trim();
      
      if (!name || !email || !password || !confirmPassword || !adminCode) {
        showAlert('register', 'Please fill in all fields');
        return;
      }
      
      if (password !== confirmPassword) {
        showAlert('register', 'Passwords do not match');
        return;
      }
      
      if (password.length < 6) {
        showAlert('register', 'Password must be at least 6 characters long');
        return;
      }
      
      showLoading('register');
      clearAlerts();
      
      try {
        const response = await fetch('http://localhost:5000/api/admin/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, email, password, adminCode })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          localStorage.setItem('adminToken', data.token);
          currentAdmin = data.admin;
          // Redirect to admin dashboard instead of showing local admin panel
          window.location.href = 'admin-dashboard.html';
        } else {
          showAlert('register', data.error || 'Registration failed');
        }
      } catch (error) {
        console.error('Registration error:', error);
        showAlert('register', 'Connection error. Please try again.');
      } finally {
        hideLoading('register');
      }
    });
    
    // Logout function
    function logout() {
      localStorage.removeItem('adminToken');
      currentAdmin = null;
      showLanding();
      
      // Reset forms
      document.getElementById('loginForm').reset();
      document.getElementById('registerForm').reset();
      clearAlerts();
    }
    
    // Redirect to specific admin dashboard section
    function redirectToSection(section) {
      // Store the section to show in localStorage
      localStorage.setItem('adminSection', section);
      // Redirect to the full admin dashboard
      window.location.href = 'admin-dashboard.html';
    }
  </script>
</body>
</html>