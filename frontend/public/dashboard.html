<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Refugee Techprenures</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --primary-bg: #f8fffe;
      --secondary-bg: #2c5f5d;
      --tertiary-accent: #00b894;
      --text-color: #2d3436;
      --card-bg: #ffffff;
      --border-color: #ddd;
    }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: var(--primary-bg);
      font-family: 'Segoe UI', Arial, sans-serif;
      color: var(--text-color);
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: row;
    }
    .sidebar {
      background: var(--secondary-bg);
      color: #fff;
      min-height: 100vh;
      width: 90px;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 1.5rem;
    }
    .sidebar .logo {
      width: 60px;
      margin-bottom: 1rem;
    }
    .sidebar .profile-img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1.5rem;
      border: 2px solid #fff;
    }
    .sidebar .nav-link {
      color: #fff;
      text-align: center;
      margin-bottom: 0.5rem;
      font-size: 1.7rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      transition: color 0.2s;
      position: relative;
      border-radius: 12px;
      padding: 0.3rem 0;
      width: 70px;
    }
    .sidebar .nav-link.active,
    .sidebar .nav-link:hover {
      background: rgba(0, 184, 148, 0.15);
      color: var(--tertiary-accent);
    }
    .sidebar .nav-link .material-icons {
      font-size: 1.8rem;
      margin-bottom: 0.1rem;
    }

    .sidebar-label {
      font-size: 0.7rem;
      margin-top: 0;
      letter-spacing: 0.02em;
      color: #fff;
      opacity: 0.85;
      transition: color 0.2s;
    }

    .sidebar .nav-link.active .sidebar-label,
    .sidebar .nav-link:hover .sidebar-label {
      color: var(--tertiary-accent);
      opacity: 1;
    }
    .sidebar .badge {
      position: relative;
      top: 0;
      right: 10px;
      background: var(--tertiary-accent);
      color: #fff;
      font-size: 0.8rem;
      border-radius: 50%;
      padding: 2px 6px;
    }
    .sidebar .sidebar-bottom {
      margin-top: auto;
      margin-bottom: 1rem;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .dashboard-wrapper {
      flex: 1 1 auto;
      min-height: 100vh;
      margin-left: 90px;
      display: flex;
      flex-direction: column;
    }
    .dashboard-header {
      background: var(--card-bg);
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .dashboard-actions {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      position: relative;
    }
    #notification-bell {
      position: relative;
      cursor: pointer;
      color: var(--text-color);
      transition: color 0.2s;
    }
    #notification-bell:hover {
      color: var(--tertiary-accent);
    }
    #notification-count {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--tertiary-accent);
      color: #fff;
      font-size: 0.8rem;
      border-radius: 50%;
      padding: 0px 6px;
      min-width: 20px;
      text-align: center;
      font-weight: bold;
      border: 2px solid #fff;
    }
    #notification-list {
      display: none;
      position: relative;
      right: 0;
      top: 2.5rem;
      min-width: 300px;
      z-index: 999;
      background: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
      overflow: hidden;
    }
    #notification-list ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    #notification-list .list-group-item {
      border: none;
      border-bottom: 1px solid var(--border-color);
      font-size: 1rem;
      padding: 0.75rem 1rem;
      color: var(--text-color);
    }
    #notification-list .list-group-item:last-child {
      border-bottom: none;
    }
    .logout-btn {
      background: var(--tertiary-accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.5rem 1.2rem;
      font-size: 1rem;
      font-weight: 500;
      margin-left: 1.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 184, 148, 0.2);
      text-decoration: none;
      display: inline-block;
    }
    .logout-btn:hover {
      background: var(--secondary-bg);
      color: #fff;
      text-decoration: none;
      transform: translateY(-1px);
    }
    .main-content {
      flex: 1 0 auto;
      padding: 2rem 2rem 2rem 2rem;
      min-height: 0;
    }
    .user-greeting {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }
    .recommendations-label {
      font-size: 1.2rem;
      color: var(--text-color);
      margin-bottom: 1.5rem;
      opacity: 0.8;
    }
    .recommendation-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1.2rem;
      margin-bottom: 2.2rem;
    }
    .recommendation-row .btn {
      flex: 1 1 220px;
      font-size: 1.15rem;
      font-weight: 600;
      padding: 1rem 0;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    /* Dashboard Analytics Styles */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .analytics-card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      border-left: 4px solid;
    }
    
    .analytics-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    
    .analytics-card.courses { border-left-color: var(--tertiary-accent); }
    .analytics-card.opportunities { border-left-color: var(--tertiary-accent); }
    .analytics-card.resources { border-left-color: var(--tertiary-accent); }
    .analytics-card.mentorship { border-left-color: var(--tertiary-accent); }
    
    .analytics-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    
    .analytics-card-icon {
      font-size: 2rem;
      color: var(--text-secondary);
    }
    
    .analytics-card-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-color);
      margin: 0;
    }
    
    .analytics-card-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }
    
    .analytics-card-change {
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .analytics-card-change.positive { color: var(--tertiary-accent); }
    .analytics-card-change.negative { color: var(--text-color); }
    
    /* Progress Section */
    .progress-section {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
    }
    
    .progress-section h3 {
      color: var(--text-color);
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }
    
    .course-progress-item {
      padding: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 1rem;
      transition: border-color 0.2s ease;
    }
    
    .course-progress-item:hover {
      border-color: var(--tertiary-accent);
    }
    
    .course-progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .course-title {
      font-weight: 600;
      color: var(--text-color);
      margin: 0;
    }
    
    .course-percentage {
      font-weight: 600;
      color: var(--tertiary-accent);
    }
    
    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: var(--tertiary-accent);
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    /* Recent Activities */
    .activities-section {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
    }
    
    .activities-section h3 {
      color: var(--text-color);
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }
    
    .activity-item {
      display: flex;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 1.2rem;
      color: white;
    }
    
    .activity-icon.course { background: var(--tertiary-accent); }
    .activity-icon.opportunity { background: var(--tertiary-accent); }
    .activity-icon.resource { background: var(--tertiary-accent); }
    .activity-icon.mentor { background: var(--tertiary-accent); }
    
    .activity-content {
      flex: 1;
    }
    
    .activity-title {
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 0.25rem;
    }
    
    .activity-time {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    
    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    
    .quick-action-btn {
      background: white;
      border: 2px solid #e0e0e0;
      padding: 1rem;
      border-radius: 12px;
      text-decoration: none;
      color: #333;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.2s ease;
    }
    
    .quick-action-btn:hover {
      border-color: var(--tertiary-accent);
      color: var(--tertiary-accent);
      text-decoration: none;
      transform: translateY(-1px);
    }
    
    .quick-action-icon {
      font-size: 1.5rem;
    }
    
    .quick-action-text {
      font-weight: 600;
    }
    .footer {
      flex-shrink: 0;
      background: var(--primary-bg);
      color: var(--card-bg);
      font-size: 0.98rem;
      padding: 0.7rem 0;
      border-top: 1px solid var(--border-color);
      margin-left: 0;
      width: 100%;
      position: static;
      margin-bottom: 0;
      bottom: 0;
      display: flex;
    }
    .footer .container-fluid {
      padding: 0 !important;
    }
    .footer-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .footer-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .footer-logo img {
      height: 28px;
    }
    .footer-links {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }
    .footer-link {
      color: rgb(72, 71, 71);
      text-decoration: none;
      margin-right: 1rem;
      transition: color 0.2s;
      font-size: 1rem;
    }
    .footer-link:hover {
      color: var(--tertiary-accent);
      text-decoration: underline;
    }
    .footer-social {
      display: inline-block;
      margin-left: 0.5rem;
      margin-right: 0.5rem;
      vertical-align: middle;
      transition: opacity 0.2s;
    }
    .footer-social:hover svg {
      fill: var(--tertiary-accent) !important;
    }
    @media (max-width: 900px) {
      .main-content { padding: 1rem 0.5rem 0 0.5rem; }
      .sidebar { width: 60px; }
      .dashboard-wrapper { margin-left: 60px; }
      .footer { margin-left: 0; }
      .recommendation-row { gap: 0.5rem; }
      .analytics-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
      .analytics-card { padding: 1rem; }
      .analytics-card-number { font-size: 2rem; }
    }
    @media (max-width: 600px) {
      .dashboard-wrapper, .main-content, .footer { margin-left: 0; padding: 0.5rem; }
      .dashboard-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
      .recommendation-row { flex-direction: column; }
      .footer-content { flex-direction: column; gap: 0.5rem; }
      .footer-links { gap: 0.7rem; }
      #notification-list {min-width: 220px;}
      .analytics-grid { grid-template-columns: 1fr; gap: 1rem; }
      .analytics-card-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
      .analytics-card-icon { font-size: 1.5rem; }
      .quick-actions { grid-template-columns: 1fr; }
      .course-progress-header { flex-direction: column; align-items: flex-start; gap: 0.25rem; }
      .user-greeting { font-size: 1.8rem; }
      .recommendations-label { font-size: 1rem; }
    }
    
    /* Forum Section Styles */
    .forum-section {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
    }
    
    .forum-section h3 {
      color: #333;
      margin-bottom: 1rem;
      font-size: 1.3rem;
    }
    
    .forum-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .forum-tabs {
      display: flex;
      gap: 0.5rem;
    }
    
    .forum-tab {
      padding: 0.5rem 1rem;
      border: 1px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }
    
    .forum-tab:hover {
      border-color: var(--tertiary-accent);
      background: #f8f9fa;
    }
    
    .forum-tab.active {
      background: var(--tertiary-accent);
      color: white;
      border-color: var(--tertiary-accent);
    }
    
    .forum-tab .badge {
      background: #ff4444;
      color: white;
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: 0.25rem;
    }
    
    .forum-filters {
      margin-bottom: 1rem;
    }
    
    .forum-filters .form-select {
      max-width: 200px;
    }
    
    .forum-messages {
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 1rem;
    }
    
    .forum-message {
      padding: 1rem;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 1rem;
      transition: border-color 0.2s ease;
    }
    
    .forum-message:hover {
      border-color: var(--tertiary-accent);
    }
    
    .forum-message-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }
    
    .forum-message-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: #666;
    }
    
    .forum-message-author {
      font-weight: 600;
      color: #333;
    }
    
    .forum-message-role {
      background: #e3f2fd;
      color: var(--tertiary-accent);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.7rem;
      text-transform: uppercase;
    }
    
    .forum-message-role.admin {
      background: #fff3e0;
      color: #f57c00;
    }
    
    .forum-message-role.mentor {
      background: #e8f5e8;
      color: var(--tertiary-accent);
    }
    
    .forum-message-subject {
      font-size: 1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 0.5rem;
    }
    
    .forum-message-content {
      font-size: 0.9rem;
      line-height: 1.5;
      color: #555;
      margin-bottom: 0.5rem;
    }
    
    .forum-message-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
      font-size: 0.85rem;
    }
    
    .forum-message-action {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      color: #666;
      transition: color 0.2s ease;
    }
    
    .forum-message-action:hover {
      color: var(--tertiary-accent);
    }
    
    .forum-message-action.liked {
      color: var(--tertiary-accent);
    }
    
    .forum-pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 1rem 0;
    }
    
    .forum-loading {
      text-align: center;
      padding: 2rem;
      color: #666;
    }
    
    .loading-spinner {
      width: 30px;
      height: 30px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--tertiary-accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 2rem;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .modal-header h3 {
      margin: 0;
      color: #333;
    }
    
    .close {
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }
    
    .close:hover {
      color: #333;
    }
    
    @media (max-width: 768px) {
      .forum-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .forum-tabs {
        justify-content: center;
      }
      
      .forum-message-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      
      .modal-content {
        margin: 2% auto;
        width: 95%;
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <img src="images/logo.png" alt="Logo" class="logo">
<a href="account.html" class="nav-link" title="Account Settings">
  <span class="material-icons">account_circle</span>
  <span class="sidebar-label">Account</span>
</a>
    <a href="dashboard.html" class="nav-link active" title="Dashboard">
      <span class="material-icons">dashboard</span>
      <span class="sidebar-label">Dashboard</span>
    </a>
    <a href="career-test.html" class="nav-link" title="Career Test">
      <span class="material-icons">psychology</span>
      <span class="sidebar-label">Career Test</span>
    </a>
    <a href="courses.html" class="nav-link" title="Courses">
      <span class="material-icons">menu_book</span>
      <span class="sidebar-label">Courses</span>
    </a>
    <a href="mentorship.html" class="nav-link" title="Mentorship">
      <span class="material-icons">group</span>
      <span class="sidebar-label">Mentorship</span>
    </a>
    <a href="opportunities.html" class="nav-link" title="Opportunities">
      <span class="material-icons">work</span>
      <span class="sidebar-label">Opportunities</span>
    </a>
    <a href="resources.html" class="nav-link" title="Startup Resources">
      <span class="material-icons">build</span>
      <span style="font-size:0.85rem;">Resources</span>
    </a>
    <div class="sidebar-bottom">
      <a href="settings.html" class="nav-link" title="App Settings">
        <span class="material-icons">settings</span>
        <span class="sidebar-label">Settings</span>
      </a>
    </div>
  </div>
  <!-- Main Content Wrapper -->
  <div class="dashboard-wrapper">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <h2 style="margin:0; font-weight:600; color:#005c3a;">Dashboard</h2>
      <div class="dashboard-actions">
        <div id="notification-bell">
          <span class="material-icons" style="font-size:2rem;">notifications</span>
          <a href="notifications.html" id="notification-toggle" class="notification-toggle">
            <span id="notification-count" class="badge">0</span>
          </a>
        </div>
        <a href="logout.html" class="logout-btn">Logout</a>
      </div>
    </div>
    <div class="main-content">
      <div class="user-greeting">
        Welcome, <span id="user-name">User</span>!
      </div>
      <div class="recommendations-label">
        Your personalized dashboard overview - Track your progress, discover new opportunities, and stay updated.
      </div>
      
      <!-- Analytics Cards -->
      <div class="analytics-grid">
        <div class="analytics-card courses">
          <div class="analytics-card-header">
            <div>
              <div class="analytics-card-label">Enrolled Courses</div>
              <div class="analytics-card-number" id="enrolled-courses">0</div>
              <div class="analytics-card-change positive" id="courses-change">+2 this week</div>
            </div>
            <span class="material-icons analytics-card-icon">school</span>
          </div>
        </div>
        
        <div class="analytics-card opportunities">
          <div class="analytics-card-header">
            <div>
              <div class="analytics-card-label">New Opportunities</div>
              <div class="analytics-card-number" id="new-opportunities">0</div>
              <div class="analytics-card-change positive" id="opportunities-change">+5 this week</div>
            </div>
            <span class="material-icons analytics-card-icon">work</span>
          </div>
        </div>
        
        <div class="analytics-card resources">
          <div class="analytics-card-header">
            <div>
              <div class="analytics-card-label">Resources Available</div>
              <div class="analytics-card-number" id="total-resources">0</div>
              <div class="analytics-card-change positive" id="resources-change">+3 new resources</div>
            </div>
            <span class="material-icons analytics-card-icon">library_books</span>
          </div>
        </div>
        
        <div class="analytics-card mentorship">
          <div class="analytics-card-header">
            <div>
              <div class="analytics-card-label">Available Mentors</div>
              <div class="analytics-card-number" id="available-mentors">0</div>
              <div class="analytics-card-change positive" id="mentors-change">+1 new mentor</div>
            </div>
            <span class="material-icons analytics-card-icon">group</span>
          </div>
        </div>
      </div>
      
      <!-- Forum Section -->
      <div class="forum-section">
        <h3><span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">forum</span>Community Forum</h3>
        <div class="forum-controls">
          <div class="forum-tabs">
            <button class="forum-tab active" onclick="switchForumTab('general')">
              <span class="material-icons">public</span> General Discussion
            </button>
            <button class="forum-tab" onclick="switchForumTab('inbox')">
              <span class="material-icons">inbox</span> Inbox <span id="unread-count" class="badge" style="display: none;">0</span>
            </button>
          </div>
          <button class="btn btn-primary btn-sm" onclick="openNewMessageModal()">
            <span class="material-icons" style="font-size: 16px;">add</span> New Message
          </button>
        </div>
        
        <!-- General Forum -->
        <div id="general-forum" class="forum-content">
          <div class="forum-filters">
            <select id="category-filter" class="form-select form-select-sm">
              <option value="all">All Categories</option>
              <option value="general">General</option>
              <option value="announcement">Announcements</option>
              <option value="question">Questions</option>
              <option value="discussion">Discussions</option>
              <option value="help">Help</option>
            </select>
          </div>
          <div id="forum-messages" class="forum-messages">
            <div class="forum-loading">
              <div class="loading-spinner"></div>
              <p>Loading forum messages...</p>
            </div>
          </div>
          <div class="forum-pagination" id="forum-pagination" style="display: none;">
            <button class="btn btn-outline-secondary btn-sm" id="prev-page" onclick="changePage(-1)">Previous</button>
            <span id="page-info">Page 1 of 1</span>
            <button class="btn btn-outline-secondary btn-sm" id="next-page" onclick="changePage(1)">Next</button>
          </div>
        </div>
        
        <!-- Inbox -->
        <div id="inbox-forum" class="forum-content" style="display: none;">
          <div id="inbox-messages" class="forum-messages">
            <div class="forum-loading">
              <div class="loading-spinner"></div>
              <p>Loading inbox...</p>
            </div>
          </div>
          <div class="forum-pagination" id="inbox-pagination" style="display: none;">
            <button class="btn btn-outline-secondary btn-sm" id="inbox-prev-page" onclick="changeInboxPage(-1)">Previous</button>
            <span id="inbox-page-info">Page 1 of 1</span>
            <button class="btn btn-outline-secondary btn-sm" id="inbox-next-page" onclick="changeInboxPage(1)">Next</button>
          </div>
        </div>
      </div>
      
      <!-- Course Progress Section -->
      <div class="progress-section">
        <h3><span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">trending_up</span>Your Course Progress</h3>
        <div id="course-progress-container">
          <!-- Progress items will be loaded here -->
        </div>
      </div>
      
      <!-- Recent Activities -->
      <div class="activities-section">
        <h3><span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">notifications</span>Recent Updates</h3>
        <div id="recent-activities">
          <!-- Activities will be loaded here -->
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="quick-actions">
        <a href="career-test.html" class="quick-action-btn">
          <span class="material-icons quick-action-icon">psychology</span>
          <span class="quick-action-text">Take Career Test</span>
        </a>
        <a href="courses.html" class="quick-action-btn">
          <span class="material-icons quick-action-icon">school</span>
          <span class="quick-action-text">Browse Courses</span>
        </a>
        <a href="opportunities.html" class="quick-action-btn">
          <span class="material-icons quick-action-icon">work</span>
          <span class="quick-action-text">View Opportunities</span>
        </a>
        <a href="mentorship.html" class="quick-action-btn">
          <span class="material-icons quick-action-icon">group</span>
          <span class="quick-action-text">Find Mentors</span>
        </a>
      </div>
      
      <div id="offline-banner" style="display:none; background:#ffecb3; color:#b26a00; padding:0.5rem; text-align:center;">
        You are offline. Progress will sync when reconnected.
      </div>
    </div>
    <!-- Footer Start -->
    <footer class="footer mt-auto">
      <div class="container-fluid">
        <div class="footer-content">
          <div class="footer-logo">
            <img src="images/logo.png" alt="EmpowerPath Logo">
            <span style="font-size:1.1rem; font-weight:600; color:#fff;">Refugee Techprenures</span>
          </div>
          <div class="footer-links">
            <a href="courses.html" class="footer-link">Learning Paths</a>
            <a href="mentorship.html" class="footer-link">Mentorship</a>
            <a href="opportunities.html" class="footer-link">Opportunities</a>
            <a href="toolkit.html" class="footer-link">Resources</a>
            <a href="#" class="footer-link">Help</a>
            <a href="#" class="footer-link">Privacy</a>
          </div>
          <div>
            <a href="#" class="footer-social" title="Facebook">
              <svg width="22" height="22" fill="#bbb" viewBox="0 0 24 24"><path d="M22.675 0h-21.35c-.733 0-1.325.592-1.325 1.326v21.348c0 .733.592 1.326 1.325 1.326h11.495v-9.294h-3.125v-3.622h3.125v-2.672c0-3.1 1.893-4.788 4.659-4.788 1.325 0 2.463.099 2.797.143v3.24l-1.918.001c-1.504 0-1.797.715-1.797 1.763v2.313h3.587l-.467 3.622h-3.12v9.293h6.116c.73 0 1.323-.593 1.323-1.326v-21.349c0-.734-.593-1.326-1.324-1.326z"/></svg>
            </a>
            <a href="#" class="footer-social" title="Website">
              <svg width="22" height="22" fill="#bbb" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.477 2 12c0 5.523 4.477 10 10 10s10-4.477 10-10c0-5.523-4.477-10-10-10zm0 18c-1.85 0-3.555-.63-4.9-1.69.03-.04.06-.08.09-.12.37-.48.73-.97 1.08-1.47.16-.23.31-.47.46-.7.13-.2.25-.41.37-.62.09-.16-.18-.32-.27-.48-.08-.15-.16-.3-.23-.45-.07-.15-.13-.3-.19-.45-.06-.15-.12-.3-.17-.45-.05-.15-.09-.3-.13-.45-.04-.15-.07-.3-.1-.45-.03-.15-.05-.3-.07-.45-.02-.15-.03-.3-.04-.45-.01-.15-.02-.3-.02-.45 0-.15.01-.3.02-.45.01-.15.02-.3.04-.45.02-.15.04-.3.07-.45.03-.15.06-.3.1-.45.04-.15.08-.3.13-.45.05-.15.11-.3.17-.45.06-.15.12-.3.19-.45.07-.15.15-.3.23-.45.09-.16.18-.32.27-.48.12-.21.24-.42.37-.62.15-.23.3-.47.46-.7.35-.5.71-.99 1.08-1.47.03-.04.06-.08.09-.12C15.555 19.37 13.85 20 12 20z"/></svg>
            </a>
          </div>
        </div>
        <div class="text-center mt-2" style="font-size:0.95rem; color:#bbb;">
          Â© 2025 Refugee Techprenures. All rights reserved.
        </div>
      </div>
    </footer>
    <!-- Footer End -->
    
    <!-- New Message Modal -->
    <div id="newMessageModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Send New Message</h3>
          <span class="close" onclick="closeNewMessageModal()">&times;</span>
        </div>
        <form id="newMessageForm" onsubmit="sendNewMessage(event)">
          <div class="mb-3">
            <label for="messageType" class="form-label">Message Type</label>
            <select class="form-select" id="messageType" onchange="toggleRecipientField()">
              <option value="general">General (Public)</option>
              <option value="private">Private Message</option>
            </select>
          </div>
          
          <div class="mb-3" id="recipientField" style="display: none;">
            <label for="messageRecipient" class="form-label">Send To</label>
            <select class="form-select" id="messageRecipient">
              <option value="">Select recipient...</option>
            </select>
          </div>
          
          <div class="mb-3" id="categoryField">
            <label for="messageCategory" class="form-label">Category</label>
            <select class="form-select" id="messageCategory">
              <option value="general">General</option>
              <option value="announcement">Announcement</option>
              <option value="question">Question</option>
              <option value="discussion">Discussion</option>
              <option value="help">Help</option>
            </select>
          </div>
          
          <div class="mb-3">
            <label for="messageSubject" class="form-label">Subject</label>
            <input type="text" class="form-control" id="messageSubject" required>
          </div>
          
          <div class="mb-3">
            <label for="messageContent" class="form-label">Message</label>
            <textarea class="form-control" id="messageContent" rows="4" required></textarea>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeNewMessageModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <span class="material-icons" style="font-size: 16px;">send</span> Send Message
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- Include offline manager -->
  <script src="js/offline-manager.js"></script>
  
  <script>
    // Enhanced Dashboard Data Management with Offline Support
    class DashboardManager {
      constructor() {
        this.apiBaseUrl = 'http://localhost:5000/api';
        this.isOnline = navigator.onLine;
        this.offlineManager = null;
        this.setupOfflineDetection();
        this.init();
      }

      setupOfflineDetection() {
        const offlineBanner = document.getElementById('offline-banner');
        
        window.addEventListener('online', () => {
          this.isOnline = true;
          console.log('Connection restored - refreshing data...');
          this.loadAnalytics();
          this.loadRecentActivities();
          this.syncOfflineData();
        });

        window.addEventListener('offline', () => {
          this.isOnline = false;
          console.log('Connection lost - switching to offline mode');
          this.loadOfflineData();
        });

        // Initial check
        if (!this.isOnline) {
          this.loadOfflineData();
        }
      }

      async init() {
        // Wait for offline manager to be ready
        const waitForOfflineManager = () => {
          return new Promise((resolve) => {
            const checkManager = () => {
              if (window.offlineManager) {
                this.offlineManager = window.offlineManager;
                resolve();
              } else {
                setTimeout(checkManager, 100);
              }
            };
            checkManager();
          });
        };
        
        await waitForOfflineManager();
        await this.loadUserData();
        await this.loadAnalytics();
        await this.loadCourseProgress();
        await this.loadRecentActivities();
        this.setupNotifications();
        this.setupOfflineButtons();
      }

      async loadUserData() {
        try {
          const user = JSON.parse(localStorage.getItem('user'));
          if (user && user.name) {
            document.getElementById('user-name').textContent = user.name;
          }
        } catch (error) {
          console.error('Error loading user data:', error);
        }
      }

      async loadAnalytics() {
        // Show loading states
        this.showLoadingState();
        
        try {
          let analytics;
          
          if (this.isOnline) {
            // Try to fetch real data from backend APIs
            analytics = {
              enrolledCourses: await this.fetchEnrolledCourses(),
              newOpportunities: await this.fetchNewOpportunities(),
              totalResources: await this.fetchTotalResources(),
              availableMentors: await this.fetchAvailableMentors()
            };
            
            // Cache analytics data for offline use
            localStorage.setItem('cachedAnalytics', JSON.stringify({
              ...analytics,
              cachedAt: Date.now()
            }));
          } else {
            // Load from offline cache
            analytics = await this.loadOfflineAnalytics();
          }

          this.updateAnalyticsCards(analytics);
          this.hideLoadingState();
        } catch (error) {
          console.error('Error loading analytics:', error);
          this.hideLoadingState();
          
          // Try to load cached data as fallback
          const fallbackAnalytics = await this.loadOfflineAnalytics();
          if (fallbackAnalytics) {
            this.updateAnalyticsCards(fallbackAnalytics);
            this.showOfflineMessage('Using cached data - some information may be outdated');
          } else {
            this.showErrorMessage('Unable to load dashboard data. Please check your connection and try again.');
          }
        }
      }

      async loadOfflineAnalytics() {
        try {
          // First try cached analytics
          const cached = localStorage.getItem('cachedAnalytics');
          if (cached) {
            const data = JSON.parse(cached);
            // Check if cache is not too old (24 hours)
            if (Date.now() - data.cachedAt < 24 * 60 * 60 * 1000) {
              return data;
            }
          }

          // If no cached data or too old, get from offline manager
          if (this.offlineManager) {
            const offlineCourses = await this.offlineManager.getOfflineCourses();
            const offlineResources = await this.offlineManager.getOfflineResources();
            
            return {
              enrolledCourses: offlineCourses.length,
              newOpportunities: 0, // Opportunities typically need fresh data
              totalResources: offlineResources.length,
              availableMentors: 0, // Mentors need fresh data for availability
              isOfflineData: true
            };
          }

          return null;
        } catch (error) {
          console.error('Error loading offline analytics:', error);
          return null;
        }
      }

      async loadOfflineData() {
        try {
          console.log('Loading offline data...');
          
          // Load analytics from cache
          const analytics = await this.loadOfflineAnalytics();
          if (analytics) {
            this.updateAnalyticsCards(analytics);
          }

          // Load offline course progress
          const offlineProgress = await this.loadOfflineCourseProgress();
          this.renderCourseProgress(offlineProgress);

          // Show offline activities
          this.renderOfflineActivities();
          
          this.showOfflineMessage('You are in offline mode. Data shown may not be current.');
        } catch (error) {
          console.error('Error loading offline data:', error);
        }
      }

      async loadOfflineCourseProgress() {
        try {
          if (!this.offlineManager) return [];

          const userId = localStorage.getItem('userId') || 'anonymous';
          const offlineProgress = await this.offlineManager.getUserProgress(userId);
          const offlineCourses = await this.offlineManager.getOfflineCourses();

          return offlineProgress.map(progress => {
            const course = offlineCourses.find(c => c.id === progress.courseId);
            return {
              id: progress.courseId,
              title: course?.title || 'Unknown Course',
              progress: progress.progress || 0,
              totalLessons: course?.materials?.length || 10,
              completedLessons: Math.floor((progress.progress || 0) / 10)
            };
          }).slice(0, 4);
        } catch (error) {
          console.error('Error loading offline course progress:', error);
          return [];
        }
      }

      renderOfflineActivities() {
        const container = document.getElementById('recent-activities');
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: #666;">
            <span class="material-icons" style="font-size: 3rem; margin-bottom: 1rem; display: block;">wifi_off</span>
            <p>Recent activities unavailable offline</p>
            <p style="font-size: 0.9rem;">Connect to internet to see latest updates</p>
          </div>
        `;
      }

      async syncOfflineData() {
        if (this.offlineManager && this.isOnline) {
          console.log('Syncing offline data...');
          await this.offlineManager.syncAllOfflineData();
          
          // Reload analytics after sync
          setTimeout(() => {
            this.loadAnalytics();
            this.loadCourseProgress();
          }, 1000);
        }
      }

      setupOfflineButtons() {
        // Add offline download buttons to courses and resources
        this.addOfflineDownloadButtons();
        
        // Add sync button to header if not exists
        this.addSyncButton();
        
        // Add offline status indicator
        this.addOfflineStatusIndicator();
      }

      addOfflineDownloadButtons() {
        // Add download buttons to course cards when viewing courses
        const style = document.createElement('style');
        style.textContent = `
          .offline-download-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background 0.2s;
          }
          .offline-download-btn:hover {
            background: #138496;
          }
          .offline-download-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
          }
          .offline-indicator {
            color: #28a745;
            font-size: 0.8rem;
            margin-left: 0.5rem;
          }
        `;
        document.head.appendChild(style);
      }

      addSyncButton() {
        const dashboardActions = document.querySelector('.dashboard-actions');
        if (!dashboardActions || document.getElementById('sync-btn')) return;

        const syncButton = document.createElement('button');
        syncButton.id = 'sync-btn';
        syncButton.innerHTML = '<span class="material-icons">sync</span>';
        syncButton.title = 'Sync offline data';
        syncButton.style.cssText = `
          background: none;
          border: 1px solid #ddd;
          border-radius: 6px;
          padding: 0.5rem;
          cursor: pointer;
          color: #666;
          transition: all 0.2s;
        `;
        
        syncButton.onmouseover = () => {
          syncButton.style.borderColor = '#4CAF50';
          syncButton.style.color = '#4CAF50';
        };
        
        syncButton.onmouseout = () => {
          syncButton.style.borderColor = '#ddd';
          syncButton.style.color = '#666';
        };
        
        syncButton.onclick = async () => {
          syncButton.innerHTML = '<span class="material-icons rotating">sync</span>';
          syncButton.disabled = true;
          
          const style = document.createElement('style');
          style.textContent = `
            @keyframes rotating {
              from { transform: rotate(0deg); }
              to { transform: rotate(360deg); }
            }
            .rotating {
              animation: rotating 1s linear infinite;
            }
          `;
          document.head.appendChild(style);
          
          try {
            if (this.offlineManager) {
              await this.offlineManager.forceSyncAll();
            }
            await this.loadAnalytics();
            await this.loadCourseProgress();
          } catch (error) {
            console.error('Sync failed:', error);
          } finally {
            syncButton.innerHTML = '<span class="material-icons">sync</span>';
            syncButton.disabled = false;
            style.remove();
          }
        };
        
        dashboardActions.insertBefore(syncButton, dashboardActions.firstChild);
      }

      addOfflineStatusIndicator() {
        const dashboardHeader = document.querySelector('.dashboard-header h2');
        if (!dashboardHeader || document.getElementById('offline-status')) return;

        const statusIndicator = document.createElement('span');
        statusIndicator.id = 'offline-status';
        statusIndicator.style.cssText = `
          font-size: 0.8rem;
          margin-left: 1rem;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-weight: normal;
        `;
        
        const updateStatus = () => {
          if (navigator.onLine) {
            statusIndicator.innerHTML = '<span class="material-icons" style="font-size: 0.8rem; vertical-align: middle;">wifi</span> Online';
            statusIndicator.style.background = '#d4edda';
            statusIndicator.style.color = '#155724';
          } else {
            statusIndicator.innerHTML = '<span class="material-icons" style="font-size: 0.8rem; vertical-align: middle;">wifi_off</span> Offline';
            statusIndicator.style.background = '#ffecb3';
            statusIndicator.style.color = '#b26a00';
          }
        };
        
        updateStatus();
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        
        dashboardHeader.appendChild(statusIndicator);
      }

      showOfflineMessage(message) {
        // Remove existing offline messages
        const existingMessage = document.querySelector('.offline-message');
        if (existingMessage) {
          existingMessage.remove();
        }

        const messageDiv = document.createElement('div');
        messageDiv.className = 'offline-message';
        messageDiv.style.cssText = `
          background: #fff3cd;
          color: #856404;
          padding: 0.75rem 1rem;
          border-radius: 8px;
          margin-bottom: 1rem;
          border-left: 4px solid #ffc107;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        `;
        messageDiv.innerHTML = `
          <span class="material-icons" style="font-size: 1rem;">info</span>
          <span>${message}</span>
        `;
        
        document.querySelector('.main-content').insertBefore(messageDiv, document.querySelector('.analytics-grid'));
        
        // Auto-hide after 5 seconds if online
        if (this.isOnline) {
          setTimeout(() => messageDiv.remove(), 5000);
        }
      }

      showLoadingState() {
        document.getElementById('enrolled-courses').textContent = '...';
        document.getElementById('new-opportunities').textContent = '...';
        document.getElementById('total-resources').textContent = '...';
        document.getElementById('available-mentors').textContent = '...';
      }

      hideLoadingState() {
        // Loading states will be replaced by actual data in updateAnalyticsCards
      }

      showErrorMessage(message) {
        // Remove existing error messages first
        const existingError = document.querySelector('.dashboard-error');
        if (existingError) {
          existingError.remove();
        }

        const errorDiv = document.createElement('div');
        errorDiv.className = 'dashboard-error';
        errorDiv.style.cssText = `
          background: #ffebee;
          color: #c62828;
          padding: 1rem;
          border-radius: 8px;
          margin-bottom: 1rem;
          border-left: 4px solid #c62828;
          display: flex;
          align-items: center;
          justify-content: space-between;
        `;
        errorDiv.innerHTML = `
          <div>
            <span class="material-icons" style="vertical-align: middle; margin-right: 0.5rem;">error</span>
            <strong>Error:</strong> ${message}
          </div>
          <button onclick="this.parentElement.remove(); window.dashboardManager.loadAnalytics();" 
                  style="background: none; border: none; color: #c62828; cursor: pointer; padding: 0.25rem; border-radius: 4px;"
                  title="Retry loading data">
            <span class="material-icons">refresh</span>
          </button>
        `;
        document.querySelector('.main-content').insertBefore(errorDiv, document.querySelector('.analytics-grid'));
      }

      updateAnalyticsCards(analytics) {
        document.getElementById('enrolled-courses').textContent = analytics.enrolledCourses;
        document.getElementById('new-opportunities').textContent = analytics.newOpportunities;
        document.getElementById('total-resources').textContent = analytics.totalResources;
        document.getElementById('available-mentors').textContent = analytics.availableMentors;

        // Update change indicators with real-time data
        document.getElementById('courses-change').textContent = 
          analytics.coursesChange || `${analytics.enrolledCourses} available`;
        document.getElementById('opportunities-change').textContent = 
          analytics.opportunitiesChange || `${analytics.newOpportunities} available`;
        document.getElementById('resources-change').textContent = 
          analytics.resourcesChange || `${analytics.totalResources} available`;
        document.getElementById('mentors-change').textContent = 
          analytics.mentorsChange || `${analytics.availableMentors} available`;
      }

      async loadCourseProgress() {
        try {
          const courseProgress = await this.fetchCourseProgress();
          this.renderCourseProgress(courseProgress);
        } catch (error) {
          console.error('Error loading course progress:', error);
          this.renderCourseProgress([]);
        }
      }

      renderCourseProgress(courses) {
        const container = document.getElementById('course-progress-container');
        if (courses.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #666;">
              <span class="material-icons" style="font-size: 3rem; margin-bottom: 1rem; display: block;">school</span>
              <p>No enrolled courses yet. <a href="courses.html" style="color: #4CAF50;">Browse available courses</a></p>
            </div>
          `;
          return;
        }

        container.innerHTML = courses.map(course => `
          <div class="course-progress-item">
            <div class="course-progress-header">
              <h4 class="course-title">${course.title}</h4>
              <span class="course-percentage">${course.progress}%</span>
            </div>
            <div class="progress-bar-container">
              <div class="progress-bar" style="width: ${course.progress}%"></div>
            </div>
            <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
              ${course.completedLessons}/${course.totalLessons} lessons completed
            </div>
          </div>
        `).join('');
      }

      async loadRecentActivities() {
        try {
          const activities = await this.fetchRecentActivities();
          this.renderRecentActivities(activities);
        } catch (error) {
          console.error('Error loading recent activities:', error);
          this.renderRecentActivities([]);
        }
      }

      renderRecentActivities(activities) {
        const container = document.getElementById('recent-activities');
        if (activities.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #666;">
              <span class="material-icons" style="font-size: 3rem; margin-bottom: 1rem; display: block;">notifications_none</span>
              <p>No recent activities</p>
            </div>
          `;
          return;
        }

        container.innerHTML = activities.map(activity => `
          <div class="activity-item">
            <div class="activity-icon ${activity.type}">
              <span class="material-icons">${activity.icon}</span>
            </div>
            <div class="activity-content">
              <div class="activity-title">${activity.title}</div>
              <div class="activity-time">${activity.time}</div>
            </div>
          </div>
        `).join('');
      }

      setupNotifications() {
        // Update notification count with real data
        this.updateNotificationCount();
        
        // Notification dropdown logic
        const notificationBell = document.getElementById('notification-bell');
        const notificationList = document.getElementById('notification-list');
        
        if (notificationBell) {
          notificationBell.onclick = function(e) {
            e.stopPropagation();
            const list = document.getElementById('notification-list');
            if (list) {
              list.style.display = (list.style.display === 'none' || !list.style.display) ? 'block' : 'none';
            }
          };
        }
        
        document.addEventListener('click', function() {
          if (notificationList) {
            notificationList.style.display = 'none';
          }
        });
      }

      async updateNotificationCount() {
        try {
          // Calculate notifications based on recent activities
          const activities = await this.fetchRecentActivities();
          const notificationCount = document.getElementById('notification-count');
          if (notificationCount) {
            notificationCount.textContent = Math.min(activities.length, 9); // Max 9 to fit in badge
          }
        } catch (error) {
          console.error('Error updating notifications:', error);
          const notificationCount = document.getElementById('notification-count');
          if (notificationCount) {
            notificationCount.textContent = '0';
          }
        }
      }

      // Real API methods - connected to backend
      async fetchEnrolledCourses() {
        try {
          const enrollments = await this.apiCall('/enrollments');
          return enrollments.length;
        } catch (error) {
          console.error('Error fetching enrolled courses:', error);
          return 0;
        }
      }

      async fetchNewOpportunities() {
        try {
          const opportunities = await this.apiCall('/opportunities');
          return opportunities.length;
        } catch (error) {
          console.error('Error fetching opportunities:', error);
          return 0;
        }
      }

      async fetchTotalResources() {
        try {
          const resources = await this.apiCall('/resources');
          return resources.length;
        } catch (error) {
          console.error('Error fetching resources:', error);
          return 0;
        }
      }

      async fetchAvailableMentors() {
        try {
          const mentors = await this.apiCall('/public/mentors');
          return mentors.filter(mentor => mentor.status === 'approved').length;
        } catch (error) {
          console.error('Error fetching mentors:', error);
          return 0;
        }
      }

      async fetchCourseProgress() {
        try {
          // Get user's enrolled courses and calculate progress
          const enrollments = await this.apiCall('/enrollments');
          const courses = await this.apiCall('/courses');
          
          // Match enrollments with course data
          const courseProgress = enrollments.map(enrollment => {
            const courseData = courses.find(course => course.title === enrollment.title);
            return {
              id: courseData?._id || enrollment._id,
              title: enrollment.title,
              progress: enrollment.progress || Math.floor(Math.random() * 100), // Use stored progress or random for demo
              totalLessons: courseData?.materials?.length || 10,
              completedLessons: Math.floor((enrollment.progress || 50) / 10)
            };
          }).slice(0, 4); // Show max 4 courses

          return courseProgress;
        } catch (error) {
          console.error('Error fetching course progress:', error);
          return [];
        }
      }

      async fetchRecentActivities() {
        try {
          const activities = [];
          
          // Get recent courses (last 5)
          const courses = await this.apiCall('/courses');
          const recentCourses = courses.slice(-2).reverse();
          recentCourses.forEach(course => {
            activities.push({
              type: 'course',
              title: `New course "${course.title}" is now available`,
              time: this.formatTimeAgo(course.createdAt),
              icon: 'school'
            });
          });

          // Get recent opportunities (last 3)
          const opportunities = await this.apiCall('/opportunities');
          const recentOpportunities = opportunities.slice(-2).reverse();
          recentOpportunities.forEach(opportunity => {
            activities.push({
              type: 'opportunity',
              title: `New ${opportunity.type} opportunity: ${opportunity.title}`,
              time: this.formatTimeAgo(opportunity.createdAt),
              icon: 'work'
            });
          });

          // Get recent resources (last 2)
          const resources = await this.apiCall('/resources');
          const recentResources = resources.slice(-1).reverse();
          recentResources.forEach(resource => {
            activities.push({
              type: 'resource',
              title: `New resource added: ${resource.title}`,
              time: this.formatTimeAgo(resource.createdAt),
              icon: 'library_books'
            });
          });

          // Sort by most recent and limit to 5
          return activities.slice(0, 5);
        } catch (error) {
          console.error('Error fetching recent activities:', error);
          return [];
        }
      }

      // Helper method for API calls with retry mechanism
      async apiCall(endpoint, retries = 3) {
        for (let i = 0; i < retries; i++) {
          try {
            const response = await fetch(`${this.apiBaseUrl}${endpoint}`);
            if (!response.ok) {
              throw new Error(`API call failed: ${response.status} ${response.statusText}`);
            }
            return await response.json();
          } catch (error) {
            console.error(`API call attempt ${i + 1} failed:`, error);
            if (i === retries - 1) {
              throw error; // Last attempt failed
            }
            // Wait before retrying (exponential backoff)
            await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
          }
        }
      }

      // Helper method to format time ago
      formatTimeAgo(dateString) {
        if (!dateString) return 'Recently';
        
        const date = new Date(dateString);
        const now = new Date();
        const diffTime = Math.abs(now - date);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const diffHours = Math.ceil(diffTime / (1000 * 60 * 60));
        const diffMinutes = Math.ceil(diffTime / (1000 * 60));

        if (diffMinutes < 60) {
          return `${diffMinutes} minute${diffMinutes === 1 ? '' : 's'} ago`;
        } else if (diffHours < 24) {
          return `${diffHours} hour${diffHours === 1 ? '' : 's'} ago`;
        } else if (diffDays === 1) {
          return 'Yesterday';
        } else if (diffDays < 7) {
          return `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;
        } else {
          return date.toLocaleDateString();
        }
      }
    }

    // Initialize dashboard when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      window.dashboardManager = new DashboardManager();
      
      // Add refresh button to dashboard header
      const dashboardHeader = document.querySelector('.dashboard-header h2');
      const refreshBtn = document.createElement('button');
      refreshBtn.innerHTML = '<span class="material-icons">refresh</span>';
      refreshBtn.style.cssText = `
        background: none;
        border: none;
        color: #005c3a;
        cursor: pointer;
        margin-left: 1rem;
        padding: 0.5rem;
        border-radius: 50%;
        transition: background-color 0.2s;
      `;
      refreshBtn.title = 'Refresh dashboard data';
      refreshBtn.onmouseover = function() { this.style.backgroundColor = '#f0f0f0'; };
      refreshBtn.onmouseout = function() { this.style.backgroundColor = 'transparent'; };
      refreshBtn.onclick = function() {
        this.style.transform = 'rotate(360deg)';
        this.style.transition = 'transform 0.5s';
        setTimeout(() => {
          this.style.transform = 'rotate(0deg)';
          this.style.transition = 'background-color 0.2s';
        }, 500);
        window.dashboardManager = new DashboardManager();
      };
      dashboardHeader.appendChild(refreshBtn);
      
      // Service worker registration
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/js/sw.js').catch(err => {
          console.log('Service Worker registration failed:', err);
        });
      }
    });

    // Auto-refresh dashboard data every 5 minutes
    setInterval(() => {
      if (document.visibilityState === 'visible' && window.dashboardManager) {
        console.log('Auto-refreshing dashboard data...');
        window.dashboardManager.loadAnalytics();
        window.dashboardManager.loadRecentActivities();
      }
    }, 5 * 60 * 1000);

    // Refresh when page becomes visible (user returns to tab)
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible' && window.dashboardManager) {
        console.log('Page visible - refreshing dashboard data...');
        window.dashboardManager.loadAnalytics();
        window.dashboardManager.loadRecentActivities();
      }
    });
  </script>
  <!-- Floating Chatbot Button -->
  <button id="open-chatbot" style="position:fixed;bottom:30px;right:30px;z-index:999;" class="btn btn-primary rounded-circle">
    <span class="material-icons">chat</span>
  </button>

  <!-- Hidden Chat Widget -->
  <div id="chatbot-widget" style="display:none;position:fixed;bottom:90px;right:30px;max-width:400px;z-index:1000;">
    <div id="chatbot-messages" style="height:300px;overflow-y:auto;border:1px solid #ccc;padding:1rem;background:#fafafa;"></div>
    <form id="chatbot-form" style="display:flex;gap:0.5rem;margin-top:0.5rem;">
      <input type="text" id="chatbot-input" class="form-control" placeholder="Type your message..." required autocomplete="off">
      <button type="submit" class="btn btn-primary">Send</button>
    </form>
    </div>
  </div>

  <!-- Material Icons (if not already included) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="js/chatbot.js"></script>
</body>
</html>